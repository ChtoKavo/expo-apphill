===================================================================
‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –¢–†–ï–ë–£–Æ–¢–°–Ø –ù–ê –°–ï–†–í–ï–†–ï
===================================================================

–ü–†–û–ë–õ–ï–ú–ê:
–ù–∞ –æ–¥–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –¥–≤–∞ –∞–∫–∫–∞—É–Ω—Ç–∞. –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ –æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç - 
–û–ë–ê –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ "–≤ —Å–µ—Ç–∏".

–ü–†–ò–ß–ò–ù–ê:
–°–µ—Ä–≤–µ—Ä –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∫ socket.id –≤–º–µ—Å—Ç–æ user_id.
–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç socket –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
—Å—Ç–∞—Ä—ã–µ socket —Å–æ–±—ã—Ç–∏—è –≤—Å–µ –µ—â–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ socket.id.

===================================================================
–†–ï–®–ï–ù–ò–ï –ù–ê –°–ï–†–í–ï–†–ï:
===================================================================

–§–ê–ô–õ: server.js –∏–ª–∏ –≥–¥–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è Socket.IO

–î–û–ë–ê–í–¨–¢–ï —ç—Ç–æ—Ç –∫–æ–¥ –≤ io.on('connection'):

```javascript
// ‚≠ê –•–†–ê–ù–ò–õ–ò–©–ï: user_id ‚Üí Set<socket.id>
// (Set –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
const userSockets = new Map();  // Map<user_id, Set<socket_id>>
const socketUsers = new Map();  // Map<socket_id, user_id>

io.on('connection', (socket) => {
  console.log('üîå –ù–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:', socket.id);
  
  // –ü–æ–ª—É—á–∞–µ–º user_id –∏–∑ query (–ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏)
  const queryUserId = socket.handshake.query?.user_id;
  
  // ‚≠ê –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  socket.on('authenticate_socket', (data) => {
    const userId = data?.user_id || queryUserId;
    
    if (!userId) {
      console.log('‚ö†Ô∏è authenticate_socket –±–µ–∑ user_id');
      return;
    }
    
    console.log(`üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: user_id=${userId}, socket_id=${socket.id}`);
    
    // ‚≠ê –ö–†–ò–¢–ò–ß–ù–û: –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ø—Ä–∏–≤—è–∑–∫—É —ç—Ç–æ–≥–æ socket (–µ—Å–ª–∏ –±—ã–ª–∞)
    const oldUserId = socketUsers.get(socket.id);
    if (oldUserId && oldUserId !== userId) {
      const oldSet = userSockets.get(oldUserId);
      if (oldSet) {
        oldSet.delete(socket.id);
        if (oldSet.size === 0) {
          userSockets.delete(oldUserId);
          // –°—Ç–∞—Ä—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–µ–ø–µ—Ä—å –æ—Ñ–ª–∞–π–Ω (–Ω–µ—Ç —Å–æ–∫–µ—Ç–æ–≤)
          io.emit('user_status_changed', {
            user_id: oldUserId,
            is_online: false,
            timestamp: new Date().toISOString()
          });
          console.log(`üî¥ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${oldUserId} –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–ª–∞–π–Ω (–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–∫–µ—Ç–æ–≤)`);
        }
      }
    }
    
    // ‚≠ê –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º socket –∫ user_id
    socketUsers.set(socket.id, userId);
    
    if (!userSockets.has(userId)) {
      userSockets.set(userId, new Set());
    }
    userSockets.get(userId).add(socket.id);
    
    // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º –∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –∫–æ–º–Ω–∞—Ç–µ
    socket.join(`user_${userId}`);
    
    console.log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId} –∏–º–µ–µ—Ç ${userSockets.get(userId).size} –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–∫–µ—Ç–æ–≤`);
  });
  
  // ‚≠ê –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ç–∞—Ç—É—Å–∞ –æ–Ω–ª–∞–π–Ω
  socket.on('user_status', (data) => {
    const { user_id, is_online } = data;
    
    if (!user_id) return;
    
    console.log(`üìä user_status: user_id=${user_id}, is_online=${is_online}`);
    
    // –†–∞—Å—Å—ã–ª–∞–µ–º –í–°–ï–ú –∫—Ä–æ–º–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
    socket.broadcast.emit('user_status_changed', {
      user_id: user_id,
      is_online: is_online,
      timestamp: new Date().toISOString()
    });
  });
  
  // ‚≠ê –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
  socket.on('disconnect', () => {
    const userId = socketUsers.get(socket.id);
    
    if (userId) {
      const userSocketSet = userSockets.get(userId);
      
      if (userSocketSet) {
        userSocketSet.delete(socket.id);
        
        // ‚≠ê –ö–†–ò–¢–ò–ß–ù–û: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ–ª–∞–π–Ω –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —É –Ω–µ–≥–æ –ù–ï–¢ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–∫–µ—Ç–æ–≤
        if (userSocketSet.size === 0) {
          userSockets.delete(userId);
          
          console.log(`üî¥ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId} –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–ª–∞–π–Ω (–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–∫–µ—Ç–æ–≤)`);
          
          io.emit('user_status_changed', {
            user_id: userId,
            is_online: false,
            timestamp: new Date().toISOString()
          });
        } else {
          console.log(`‚ö° –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId} –µ—â—ë –æ–Ω–ª–∞–π–Ω (${userSocketSet.size} —Å–æ–∫–µ—Ç–æ–≤)`);
        }
      }
      
      socketUsers.delete(socket.id);
    }
    
    console.log('üîå –û—Ç–∫–ª—é—á–µ–Ω–∏–µ:', socket.id);
  });
});

// ‚≠ê –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
function isUserOnline(userId) {
  const sockets = userSockets.get(String(userId));
  return sockets && sockets.size > 0;
}

function getUserSockets(userId) {
  return userSockets.get(String(userId)) || new Set();
}
```

===================================================================
–í–ê–ñ–ù–û:
===================================================================

1. ‚≠ê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–±–∞–≤—å—Ç–µ –≤—Å–µ —Ç—Ä–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞:
   - authenticate_socket
   - user_status
   - disconnect

2. ‚≠ê –ö–†–ò–¢–ò–ß–ù–û: –ú–∞–ø–ø–∏–Ω–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
   userSockets: Map<user_id, Set<socket_id>>
   (–∞ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç!)

3. ‚≠ê –°–æ–∫–µ—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ñ–ª–∞–π–Ω –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞:
   - userSockets[user_id].size === 0
   (—Ç–æ –µ—Å—Ç—å –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)

4. ‚≠ê –ù–µ –∑–∞–±—É–¥—å—Ç–µ export —Ñ—É–Ω–∫—Ü–∏–∏:
   - isUserOnline(userId)
   - getUserSockets(userId)

===================================================================
–ü–†–û–í–ï–†–ö–ê:
===================================================================

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞:

‚úÖ –ü—Ä–∏ –≤—Ö–æ–¥–µ –ø–µ—Ä–≤–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞:
   üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: user_id=1, socket_id=abc123
   ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1 –∏–º–µ–µ—Ç 1 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–∫–µ—Ç–æ–≤

‚úÖ –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤—Ç–æ—Ä–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (–Ω–æ–≤—ã–π socket):
   üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: user_id=2, socket_id=xyz789
   ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2 –∏–º–µ–µ—Ç 1 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–∫–µ—Ç–æ–≤

‚úÖ –ü—Ä–∏ logout –ø–µ—Ä–≤–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞:
   üî¥ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1 –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–ª–∞–π–Ω (–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–∫–µ—Ç–æ–≤)

===================================================================
–ö–õ–ò–ï–ù–¢ –£–ñ–ï –ì–û–¢–û–í:
===================================================================

–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ —É–∂–µ —Å–¥–µ–ª–∞–Ω—ã –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

‚úÖ globalSocket.js:
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç currentUserId
   - –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç socket –ø—Ä–∏ —Å–º–µ–Ω–µ user_id
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç user_status –ø—Ä–∏ connect/disconnect

‚úÖ LoginScreen.js, RegisterScreen.js:
   - –í—ã–∑—ã–≤–∞—é—Ç resetSocket() –ø–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

‚úÖ ProfileScreen.js:
   - –í—ã–∑—ã–≤–∞–µ—Ç disconnectSocket() –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ

‚úÖ ChatsListScreen.js:
   - –û—á–∏—â–∞–µ—Ç –≤—Å–µ —á–∞—Ç—ã –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ –¥–ª—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ ID

===================================================================
